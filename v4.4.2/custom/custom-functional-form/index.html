<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Custom functional form · ReactiveMP.jl</title><meta name="title" content="Custom functional form · ReactiveMP.jl"/><meta property="og:title" content="Custom functional form · ReactiveMP.jl"/><meta property="twitter:title" content="Custom functional form · ReactiveMP.jl"/><meta name="description" content="Documentation for ReactiveMP.jl."/><meta property="og:description" content="Documentation for ReactiveMP.jl."/><meta property="twitter:description" content="Documentation for ReactiveMP.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ReactiveMP.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/nodes/">Factor nodes</a></li><li><a class="tocitem" href="../../lib/message/">Messages</a></li><li><a class="tocitem" href="../../lib/marginal/">Marginals</a></li><li><a class="tocitem" href="../../lib/rules/">Message update rules</a></li><li><a class="tocitem" href="../../lib/helpers/">Helper utils</a></li><li><a class="tocitem" href="../../lib/algebra/">Algebra utils</a></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Specific factor nodes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lib/nodes/delta/">Delta</a></li><li><a class="tocitem" href="../../lib/nodes/flow/">Flow</a></li><li><a class="tocitem" href="../../lib/nodes/bifm/">BIFM</a></li><li><a class="tocitem" href="../../lib/nodes/logical/">Logical</a></li><li><a class="tocitem" href="../../lib/nodes/ctransition/">Continuous transition</a></li><li><a class="tocitem" href="../../lib/nodes/ar/">Autoregressive</a></li></ul></li></ul></li><li><span class="tocitem">Custom functionality</span><ul><li class="is-active"><a class="tocitem" href>Custom functional form</a><ul class="internal"><li><a class="tocitem" href="#Interface"><span>Interface</span></a></li><li><a class="tocitem" href="#custom-functional-form-example"><span>Custom Functional Form Example</span></a></li><li><a class="tocitem" href="#Wrapped-Form-Constraints"><span>Wrapped Form Constraints</span></a></li></ul></li><li><a class="tocitem" href="../custom-addons/">Custom addons</a></li></ul></li><li><span class="tocitem">Extra</span><ul><li><a class="tocitem" href="../../extra/contributing/">Contributing</a></li><li><a class="tocitem" href="../../extra/extensions/">Extensions</a></li><li><a class="tocitem" href="../../extra/methods/">Exported methods</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Custom functionality</a></li><li class="is-active"><a href>Custom functional form</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Custom functional form</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/ReactiveMP.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/main/docs/src/custom/custom-functional-form.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="custom-functional-form"><a class="docs-heading-anchor" href="#custom-functional-form">Custom Functional Form Specification</a><a id="custom-functional-form-1"></a><a class="docs-heading-anchor-permalink" href="#custom-functional-form" title="Permalink"></a></h1><p>In a nutshell, functional form constraints defines a function that approximates the product of colliding messages and computes posterior marginal that can be used later on during the inference procedure. An important part of the functional forms constraint implementation is the <code>prod</code> function in the <a href="https://reactivebayes.github.io/BayesBase.jl/stable/"><code>BayesBase</code></a> package. For example, if we refer to our <code>CustomFunctionalForm</code> as to <code>f</code> we can see the whole functional form constraints pipeline as:</p><p class="math-container">\[q(x) = f\left(\frac{\overrightarrow{\mu}(x)\overleftarrow{\mu}(x)}{\int \overrightarrow{\mu}(x)\overleftarrow{\mu}(x) \mathrm{d}x}\right)\]</p><h2 id="Interface"><a class="docs-heading-anchor" href="#Interface">Interface</a><a id="Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Interface" title="Permalink"></a></h2><p><code>ReactiveMP.jl</code>, however, uses some extra utility functions to define functional form constraint behaviour. Here we briefly describe all utility function. If you are only interested in the concrete example, you may directly head to the <a href="#custom-functional-form-example">Custom Functional Form</a> example at the end of this section.</p><h3 id="Abstract-super-type"><a class="docs-heading-anchor" href="#Abstract-super-type">Abstract super type</a><a id="Abstract-super-type-1"></a><a class="docs-heading-anchor-permalink" href="#Abstract-super-type" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.AbstractFormConstraint" href="#ReactiveMP.AbstractFormConstraint"><code>ReactiveMP.AbstractFormConstraint</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractFormConstraint</code></pre><p>Every functional form constraint is a subtype of <code>AbstractFormConstraint</code> abstract type.</p><p>Note: this is not strictly necessary, but it makes automatic dispatch easier and compatible with the <code>CompositeFormConstraint</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L17-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.UnspecifiedFormConstraint" href="#ReactiveMP.UnspecifiedFormConstraint"><code>ReactiveMP.UnspecifiedFormConstraint</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">UnspecifiedFormConstraint</code></pre><p>One of the form constraint objects. Does not imply any form constraints and simply returns the same object as receives. However it does not allow <code>DistProduct</code> to be a valid functional form in the inference backend.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L72-L77">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.CompositeFormConstraint" href="#ReactiveMP.CompositeFormConstraint"><code>ReactiveMP.CompositeFormConstraint</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CompositeFormConstraint</code></pre><p>Creates a composite form constraint that applies form constraints in order. The composed form constraints must be compatible and have the exact same <code>form_check_strategy</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L132-L136">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.preprocess_form_constraints" href="#ReactiveMP.preprocess_form_constraints"><code>ReactiveMP.preprocess_form_constraints</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">preprocess_form_constraints(constraints)</code></pre><p>This function preprocesses form constraints and converts the provided objects into a form compatible with ReactiveMP inference backend (if possible).  If a tuple of constraints is passed, it creates a <code>CompositeFormConstraint</code> object. Wraps unknown form constraints into a <code>WrappedFormConstraint</code> object.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L120-L125">source</a></section></article><h3 id="Form-check-strategy"><a class="docs-heading-anchor" href="#Form-check-strategy">Form check strategy</a><a id="Form-check-strategy-1"></a><a class="docs-heading-anchor-permalink" href="#Form-check-strategy" title="Permalink"></a></h3><p>Every custom functional form must implement a new method for the <a href="#ReactiveMP.default_form_check_strategy"><code>default_form_check_strategy</code></a> function that returns either <a href="#ReactiveMP.FormConstraintCheckEach"><code>FormConstraintCheckEach</code></a> or <a href="#ReactiveMP.FormConstraintCheckLast"><code>FormConstraintCheckLast</code></a>.</p><ul><li><code>FormConstraintCheckLast</code>: <code>q(x) = f(μ1(x) * μ2(x) * μ3(x))</code></li><li><code>FormConstraintCheckEach</code>: <code>q(x) = f(f(μ1(x) * μ2(x)) * μ3(x))</code></li></ul><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.default_form_check_strategy" href="#ReactiveMP.default_form_check_strategy"><code>ReactiveMP.default_form_check_strategy</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">default_form_check_strategy(form_constraint)</code></pre><p>Returns a default check strategy (e.g. <code>FormConstraintCheckEach</code> or <code>FormConstraintCheckEach</code>) for a given form constraint object.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L51-L55">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.FormConstraintCheckEach" href="#ReactiveMP.FormConstraintCheckEach"><code>ReactiveMP.FormConstraintCheckEach</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">FormConstraintCheckEach</code></pre><p>This form constraint check strategy checks functional form of the messages product after each product in an equality chain.  Usually if a variable has been connected to multiple nodes we want to perform multiple <code>prod</code> to obtain a posterior marginal. With this form check strategy <code>constrain_form</code> function will be executed after each subsequent <code>prod</code> function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L26-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.FormConstraintCheckLast" href="#ReactiveMP.FormConstraintCheckLast"><code>ReactiveMP.FormConstraintCheckLast</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">FormConstraintCheckEach</code></pre><p>This form constraint check strategy checks functional form of the last messages product in the equality chain.  Usually if a variable has been connected to multiple nodes we want to perform multiple <code>prod</code> to obtain a posterior marginal. With this form check strategy <code>constrain_form</code> function will be executed only once after all subsequenct <code>prod</code> functions have been executed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L35-L41">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.FormConstraintCheckPickDefault" href="#ReactiveMP.FormConstraintCheckPickDefault"><code>ReactiveMP.FormConstraintCheckPickDefault</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">FormConstraintCheckPickDefault</code></pre><p>This form constraint check strategy simply fallbacks to a default check strategy for a given form constraint. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L44-L48">source</a></section></article><h3 id="Prod-constraint"><a class="docs-heading-anchor" href="#Prod-constraint">Prod constraint</a><a id="Prod-constraint-1"></a><a class="docs-heading-anchor-permalink" href="#Prod-constraint" title="Permalink"></a></h3><p>Every custom functional form must implement a new method for the <a href="#ReactiveMP.default_prod_constraint"><code>default_prod_constraint</code></a> function that returns a proper <code>prod_constraint</code> object.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.default_prod_constraint" href="#ReactiveMP.default_prod_constraint"><code>ReactiveMP.default_prod_constraint</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">default_prod_constraint(form_constraint)</code></pre><p>Returns a default prod constraint needed to apply a given <code>form_constraint</code>. For most form constraints this function returns <code>ProdGeneric</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L58-L62">source</a></section></article><h3 id="Constrain-form,-a.k.a-f"><a class="docs-heading-anchor" href="#Constrain-form,-a.k.a-f">Constrain form, a.k.a <code>f</code></a><a id="Constrain-form,-a.k.a-f-1"></a><a class="docs-heading-anchor-permalink" href="#Constrain-form,-a.k.a-f" title="Permalink"></a></h3><p>The main function that a custom functional form must implement, which we referred to as <code>f</code> in the beginning of this section, is the <a href="#ReactiveMP.constrain_form"><code>constrain_form</code></a> function.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.constrain_form" href="#ReactiveMP.constrain_form"><code>ReactiveMP.constrain_form</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">constrain_form(constraint, something)</code></pre><p>This function applies a given form constraint to a given object. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L65-L69">source</a></section></article><h2 id="custom-functional-form-example"><a class="docs-heading-anchor" href="#custom-functional-form-example">Custom Functional Form Example</a><a id="custom-functional-form-example-1"></a><a class="docs-heading-anchor-permalink" href="#custom-functional-form-example" title="Permalink"></a></h2><p>In this demo, we show how to build a custom functional form constraint that is compatible with the <code>ReactiveMP.jl</code> inference backend. An important part of the functional form constraint implementation is the <code>prod</code> function in the <a href="https://reactivebayes.github.io/BayesBase.jl/stable/"><code>BayesBase</code></a> package. We present a relatively simple use case, which may not be very practical but serves as a straightforward step-by-step guide.</p><p>Assume that we want a specific posterior marginal of some random variable in our model to have a specific Gaussian parameterization, such as mean-precision. Here, how we can achieve this with our custom <code>MeanPrecisionFormConstraint</code> functional form constraint:</p><pre><code class="language-julia hljs">using ReactiveMP, ExponentialFamily, Distributions, BayesBase

# First, we define our functional form structure with no fields
struct MeanPrecisionFormConstraint &lt;: AbstractFormConstraint end

ReactiveMP.default_form_check_strategy(::MeanPrecisionFormConstraint) = FormConstraintCheckLast()
ReactiveMP.default_prod_constraint(::MeanPrecisionFormConstraint) = GenericProd()

function ReactiveMP.constrain_form(::MeanPrecisionFormConstraint, distribution)
    # This assumes that the given `distribution` object has `mean` and `precision` defined.
    # These quantities might be approximated using other methods, such as Laplace approximation.
    m = mean(distribution)      # or approximate with some other method
    p = precision(distribution) # or approximate with some other method
    return NormalMeanPrecision(m, p)
end

function ReactiveMP.constrain_form(::MeanPrecisionFormConstraint, distribution::BayesBase.ProductOf)
    # `ProductOf` is a special case. Read more about this type in the corresponding
    # documentation section of the `BayesBase` package.
    # ...
end

constraint = ReactiveMP.preprocess_form_constraints(MeanPrecisionFormConstraint())

constrain_form(constraint, NormalMeanVariance(0, 2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ExponentialFamily.NormalMeanPrecision{Float64}(μ=0.0, w=0.5)</code></pre><h2 id="Wrapped-Form-Constraints"><a class="docs-heading-anchor" href="#Wrapped-Form-Constraints">Wrapped Form Constraints</a><a id="Wrapped-Form-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapped-Form-Constraints" title="Permalink"></a></h2><p>Some constraint objects might not be subtypes of <code>AbstractFormConstraint</code>. This can occur, for instance, if the object is defined in a different package or needs to subtype a different abstract type. In such cases, <code>ReactiveMP</code> expects users to pass a <code>WrappedFormConstraint</code> object, which wraps the original object and makes it compatible with the <code>ReactiveMP</code> inference backend. Note that the <a href="#ReactiveMP.preprocess_form_constraints"><code>ReactiveMP.preprocess_form_constraints</code></a> function automatically wraps all objects that are not subtypes of <code>AbstractFormConstraint</code>.</p><p>Additionally, objects wrapped by <code>WrappedFormConstraints</code> may implement the <code>ReactiveMP.prepare_context</code> function. This function&#39;s output will be stored in the <code>WrappedFormConstraints</code> along with the original object. If <code>prepare_context</code> is implemented, the <code>constrain_form</code> function will take three arguments: the original constraint, the context, and the object that needs to be constrained.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.WrappedFormConstraint" href="#ReactiveMP.WrappedFormConstraint"><code>ReactiveMP.WrappedFormConstraint</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">WrappedFormConstraint(constraint, context)</code></pre><p>This is a wrapper for a form constraint object. It allows to pass additional context to the <code>constrain_form</code> function. By default all objects that are not sub-typed from <code>AbstractFormConstraint</code> are wrapped into this object.  Use <code>ReactiveMP.prepare_context</code> to provide an extra context for a given form constraint, that can be reused between multiple <code>constrain_form</code> calls.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L86-L92">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.prepare_context" href="#ReactiveMP.prepare_context"><code>ReactiveMP.prepare_context</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">prepare_context(constraint)</code></pre><p>This function prepares a context for a given form constraint. Returns <code>WrappedFormConstraintNoContext</code> if no context is needed (the default behaviour).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L100-L104">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.constrain_form-Tuple{ReactiveMP.WrappedFormConstraint, Any}" href="#ReactiveMP.constrain_form-Tuple{ReactiveMP.WrappedFormConstraint, Any}"><code>ReactiveMP.constrain_form</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">constrain_form(wrapped::WrappedFormConstraint, something)</code></pre><p>This function unwraps the <code>wrapped</code> object and calls <code>constrain_form</code> function with the provided context. If the context is not provided, simply calls <code>constrain_form</code> with the wrapped constraint. Otherwise passes the context to the <code>constrain_form</code> function as the second argument.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/f4362de3beebddb1fa781e6f2acc2561d21a3d10/src/constraints/form.jl#L107-L112">source</a></section></article><pre><code class="language-julia hljs">using ReactiveMP, Distributions, BayesBase, Random

# First, we define our custom form constraint that creates a set of samples
# Note that this is not a subtype of `AbstractFormConstraint`
struct MyCustomSampleListFormConstraint end

# Note that we still need to implement `default_form_check_strategy` and `default_prod_constraint` functions
#  which are necessary for the `ReactiveMP` inference backend
ReactiveMP.default_form_check_strategy(::MyCustomSampleListFormConstraint) = FormConstraintCheckLast()
ReactiveMP.default_prod_constraint(::MyCustomSampleListFormConstraint) = GenericProd()

# We implement the `prepare_context` function, which returns a random number generator
function ReactiveMP.prepare_context(constraint::MyCustomSampleListFormConstraint)
    return Random.default_rng()
end

# We implement the `constrain_form` function, which returns a set of samples
function ReactiveMP.constrain_form(constraint::MyCustomSampleListFormConstraint, context, distribution)
    return rand(context, distribution, 10)
end

constraint = ReactiveMP.preprocess_form_constraints(MyCustomSampleListFormConstraint())

constrain_form(constraint, Normal(0, 10))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">10-element Vector{Float64}:
   7.280657851767182
  -3.6112801320011636
 -11.466565905070574
   3.961227966302372
  -0.6083614171244858
  -5.089534459726086
   5.041828181212945
   0.05371425086271884
 -15.749586996880431
  -4.39327113567739</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../lib/nodes/ar/">« Autoregressive</a><a class="docs-footer-nextpage" href="../custom-addons/">Custom addons »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 3 October 2024 11:42">Thursday 3 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
