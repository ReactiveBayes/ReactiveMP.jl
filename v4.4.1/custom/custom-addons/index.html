<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Custom addons · ReactiveMP.jl</title><meta name="title" content="Custom addons · ReactiveMP.jl"/><meta property="og:title" content="Custom addons · ReactiveMP.jl"/><meta property="twitter:title" content="Custom addons · ReactiveMP.jl"/><meta name="description" content="Documentation for ReactiveMP.jl."/><meta property="og:description" content="Documentation for ReactiveMP.jl."/><meta property="twitter:description" content="Documentation for ReactiveMP.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ReactiveMP.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/nodes/">Factor nodes</a></li><li><a class="tocitem" href="../../lib/message/">Messages</a></li><li><a class="tocitem" href="../../lib/marginal/">Marginals</a></li><li><a class="tocitem" href="../../lib/rules/">Message update rules</a></li><li><a class="tocitem" href="../../lib/helpers/">Helper utils</a></li><li><a class="tocitem" href="../../lib/algebra/">Algebra utils</a></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Specific factor nodes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lib/nodes/delta/">Delta</a></li><li><a class="tocitem" href="../../lib/nodes/flow/">Flow</a></li><li><a class="tocitem" href="../../lib/nodes/bifm/">BIFM</a></li><li><a class="tocitem" href="../../lib/nodes/logical/">Logical</a></li><li><a class="tocitem" href="../../lib/nodes/ctransition/">Continuous transition</a></li><li><a class="tocitem" href="../../lib/nodes/ar/">Autoregressive</a></li></ul></li></ul></li><li><span class="tocitem">Custom functionality</span><ul><li><a class="tocitem" href="../custom-functional-form/">Custom functional form</a></li><li class="is-active"><a class="tocitem" href>Custom addons</a><ul class="internal"><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li></ul></li><li><span class="tocitem">Extra</span><ul><li><a class="tocitem" href="../../extra/contributing/">Contributing</a></li><li><a class="tocitem" href="../../extra/extensions/">Extensions</a></li><li><a class="tocitem" href="../../extra/methods/">Exported methods</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Custom functionality</a></li><li class="is-active"><a href>Custom addons</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Custom addons</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/ReactiveMP.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/main/docs/src/custom/custom-addons.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="custom-addons"><a class="docs-heading-anchor" href="#custom-addons">Custom Addons</a><a id="custom-addons-1"></a><a class="docs-heading-anchor-permalink" href="#custom-addons" title="Permalink"></a></h1><p>Standard message passing schemes only pass along distributions to other nodes. However, for more advanced usage, there might be a need for passing along additional information in messages and/or marginals. One can for example think of passing along the scaling of the distribution or some information that specifies how the message or marginal was computed, i.e. which messages were used for its computation and which node was preceding it. Another use cases is saving extra debugging information inside messages themselves, e.g. what arguments have been used to compute a message.</p><p>Addons provide a solution here. Basically, addons are structures that contain extra information that are passed along the graph with messages and marginals in a tuple. These addons can be extracted using the <code>getaddons(message/marginal)</code> function. Its usage and operations can differ significantly for each application, yet below gives a concise overview on how to implement them on your own.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Suppose that we wish to create an addon that counts the number of computations that preceded some message or marginal. This addon can be created by adding the file <code>src/addons/count.jl</code> and by including it in the <code>ReactiveMP.jl</code> file.</p><h3 id="Step-1:-Creating-the-addon-structure"><a class="docs-heading-anchor" href="#Step-1:-Creating-the-addon-structure">Step 1: Creating the addon structure</a><a id="Step-1:-Creating-the-addon-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1:-Creating-the-addon-structure" title="Permalink"></a></h3><p>Let&#39;s start by defining our new addon structure. This might seem daunting, but basically only requires us to specify the information that we would like to collect. Just make sure that it is specified as a subtype of <code>AbstractAddon</code>. In our example this becomes:</p><pre><code class="language-julia hljs">struct AddonCount{T} &lt;: AbstractAddon
    count :: T
end</code></pre><p>You can add additional fields or functions for improved handling, such as <code>get_count()</code> or <code>show()</code> functions.</p><h3 id="Step-2:-Compute-addon-value-after-computing-a-message"><a class="docs-heading-anchor" href="#Step-2:-Compute-addon-value-after-computing-a-message">Step 2: Compute addon value after computing a message</a><a id="Step-2:-Compute-addon-value-after-computing-a-message-1"></a><a class="docs-heading-anchor-permalink" href="#Step-2:-Compute-addon-value-after-computing-a-message" title="Permalink"></a></h3><p>As a second step we need to specify how the addon behaves when a new message is computed in a factor node.  For this purpose we need to implement a specialized version of the <code>message_mapping_addon()</code> function. This function accepts the mapping variables of the factor node and updates the addons by extending the tuple.</p><p>In our example we could write</p><pre><code class="language-julia hljs"># This specification assumes that the default value for addon is `AddonCount(nothing)`
function message_mapping_addon(::AddonCount{Nothing}, mapping, messages, marginals, result, addons)

    # get number of operations of messages
    message_count = 0
    for message in messages
        message_count += getcount(message)
    end

    # get number of operations of marginals
    marginal_count = 0
    for marginal in marginals
        marginal_count += getcount(marginal)
    end

    # extend addons with AddonCount() structure
    return AddonCount(message_count + marginal_count + 1)
end
</code></pre><h3 id="Step-3:-Computing-products"><a class="docs-heading-anchor" href="#Step-3:-Computing-products">Step 3: Computing products</a><a id="Step-3:-Computing-products-1"></a><a class="docs-heading-anchor-permalink" href="#Step-3:-Computing-products" title="Permalink"></a></h3><p>The goal is to update the <code>AddonCount</code> structure when we multiply 2 messages. As a result, we need to write a function that allows us to define this behaviour. This function is called <code>multiply_addons</code> and accepts 5 arguments. In our example this becomes</p><pre><code class="language-julia hljs">function multiply_addons(left_addon::AddonCount, right_addon::AddonCount, new_dist, left_dist, right_dist)
    return AddonCount(left_addon.count + right_addon.count + 1)
end</code></pre><p>here we add the number of operations from the addons that are being multiplied and we add one (for the current operation). we are aware that this is likely not valid for iterative message passing schemes, but it still serves as a nice example. the <code>left_addon</code> and <code>right_addon</code> argument specify the <code>addoncount</code> objects that are being multiplied. corresponding to these addons, there are the distributions <code>left_dist</code> and <code>right_dist</code>, which might contain information for computing the product. the new distribution <code>new_dist ∝ left_dist * right_dist</code> is also passed along for potentially reusing the result of earlier computations.</p><h3 id="More-information"><a class="docs-heading-anchor" href="#More-information">More information</a><a id="More-information-1"></a><a class="docs-heading-anchor-permalink" href="#More-information" title="Permalink"></a></h3><p>For more advanced information check the implementation of the log-scale or memory addons.</p><h3 id="Built-in-addons"><a class="docs-heading-anchor" href="#Built-in-addons">Built-in addons</a><a id="Built-in-addons-1"></a><a class="docs-heading-anchor-permalink" href="#Built-in-addons" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ReactiveMP.AddonDebug" href="#ReactiveMP.AddonDebug"><code>ReactiveMP.AddonDebug</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AddonDebug(f :: Function)</code></pre><p>This addon calls the function <code>f</code> over the output of the message mapping and products. The result is expected to be boolean and when returning true, it will throw an error with the debug information. Common applications of this addon are to check for NaNs and Infs in the messages and marginals. </p><p><strong>Example</strong></p><pre><code class="language-julia hljs">checkfornans(x) = isnan(x)
checkfornans(x::AbstractArray) = any(checkfornans.(x))
checkfornans(x::Tuple) = any(checkfornans.(x))

addons = (AddonDebug(dist -&gt; checkfornans(params(dist))),)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ReactiveBayes/ReactiveMP.jl/blob/9af77aa55d78f429c2c571e4ad444ae1c48d6b9c/src/addons/debug.jl#L3-L16">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../custom-functional-form/">« Custom functional form</a><a class="docs-footer-nextpage" href="../../extra/contributing/">Contributing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 20 September 2024 15:54">Friday 20 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
